## 一、药物信息部分
#### 1 修改处方时间数量为固定 6 个，修改处方服药量数量为固定六个，且修改这两部分的格式
- 将不定长的数组改为定长，数量改为定长六个。 
![](肥猫的小世界/肥猫的学习世界/STM32/项目笔记/json修改.png)


#### 2 app 存储药盒id与药品的关系

#### 3 修改json中变量名 改为简写或缩写



```json
topic: drug_info_topic

用户处方：
{
    "sn":"xxx", //设备序列号  6位字符串
    "type":0,//"add"改为0、1、2对应  //add 添加，update: 修改，delete: 删除
    "name":"阿司匹林",
    "barcode":"12345678901234",
    "id":1, //药盒id，一个机器8个药盒
    "times":"8:00,14:00,20:30,0:0,0:0,0:0",
    "doses":[1,2,1,0,0,0],  // 对应times里面吃药个数
    "total_days":30,  //这个药一共吃几天，先不展示
    "active_days":5,  // 周期内连续吃药天数 
    "pause_days":2,   //周期内停用天数
    "current_days":3, //第几天 ，用于判断当前天是否展示按时间的处方信息，如果当前不需要服务药，就不展示处方
    "shortage":0,  //缺药状态：0=正常，1=缺药 ，app端不用
    "consumption":1  // 服药状态：0=未服用，1=服用完成 ，app端不用
}
```


```json
topic: drug_info_topic

用户处方：
{
    "sn":"xxx", //设备序列号  6位字符串
    "type":0,//"add"改为0、1、2对应  //add 添加，update: 修改，delete: 删除
    "name":"阿司匹林",
    "bar":"12345678901234",
    "id":1, //药盒id，一个机器8个药盒
    "times":"8:00,14:00,20:30,0:0,0:0,0:0",
    "doses":[1,2,1,0,0,0],  // 对应times里面吃药个数
    "tday":30,  //这个药一共吃几天，先不展示
    "aday":5,  // 周期内连续吃药天数 
    "pday":2,   //周期内停用天数
    "cday":3, //第几天 ，用于判断当前天是否展示按时间的处方信息，如果当前不需要服务药，就不展示处方
    "sho":0,  //缺药状态：0=正常，1=缺药 ，app端不用
    "con":1  // 服药状态：0=未服用，1=服用完成 ，app端不用
}
```


- 修改后json格式
```json

{
    "sn":"abc123",
    "type":0,
    "name":"阿司匹林",
    "bar":"12345678901234",
    "id":1,
    "times":"8:00,14:00,20:30,0:0,0:0,0:0",
    "doses":[1,2,1,0,0,0],
    "tday":30,
    "aday":5,
    "pday":2,
    "cday":3,
    "sho":0,
    "con":1
}
```

#### 4 将引号都去掉，逗号改成分号

```
{sn:123456;type:0;name:d2f8c7ccbde2b6bebfc5c1a3;bar:9999999999999;id:2;times:8:0;12:0;14:30;18:0;0:0;0:0;doses:1;2;3;4;0;0;tdays:30;adays:5;pdays:2;cdays:1;sho:0;con:0}
```


## 二 服药信息

#### 1 简化药物信息 通过药盒id知道某个药品是否正常取药
```json
topic: drug_record_topic

{
    "sn": "123456",               //设备序列号
    "time": "hh:mm",              //时间，通过这个时间匹配处方时间轴上的吃药状态
    "medication_box_status": 1,    //服药盒状态， 0是未取，1是已取
    "completed": 1,                            //流程状态
    "drug_count": 2,                           //药物数量
    "drug_id": [1,2,3,4,5,6,7,8],    // 本时间点服药的药盒id 需要通过这个id找到药品名
    "drug_status":[1,1,0,0,0,0,0,0]    //取药状态,   0是未取，1是已取
}
```

#### 2 简化变量名

- 修改后json

```json
topic: drug_record_topic

{
    "sn":"abc123",
    "time":"hh:mm",
    "box_status":1,
    "completed":1,
    "drug_count":2,
    "drug_id":[1,2,3,4,5,6,7,8],
    "drug_status":[1,1,0,0,0,0,0,0]
}
```


![](肥猫的小世界/肥猫的学习世界/STM32/项目笔记/json修改-1.png)





## 三 设备状态



``` json
{ "sn": "1234567", //设备id 
	"temperature": 35.4, //温度 
	"humidity": 24.4, //湿度 
	"status":0
}


```